@inherits DotNetNuke.Web.Mvc.Framework.DnnWebViewPage<Dnn.Bce.Dnn.Idopontfoglalas.Models.ReservationEntity>
@using DotNetNuke.Web.Client.ClientResourceManagement
@using DotNetNuke.Framework.JavaScriptLibraries
@{
    ViewBag.Title = "Új foglalás létrehozása";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/hu.js"></script>

<script>
    @*var url = '@Url.Action("GetFullHours", "Reservation")';
    let fullHours = [];
    function fetchFullHours() {
        fetch(url)
            .then(response => response.json())
            .then(data => {
                fullHours = data.map(d => new Date(d));
            });
    };*@

    (function () {
        function getRoundedDate() {
            const now = new Date();
            now.setSeconds(0);
            now.setMilliseconds(0);
            if (now.getMinutes() > 0) {
                now.setHours(now.getHours() + 1);
                now.setMinutes(0);
            }
            return now;
        }

        function initializeFlatpickr() {
            if (typeof flatpickr !== 'undefined') {
                flatpickr("#StartTime", {
                    enableTime: true,
                    time_24hr: true,
                    enableSeconds: false,
                    minuteIncrement: 60,
                    defaultMinute: 0,
                    defaultDate: getRoundedDate(),
                    minDate: "today",
                    allowInput: false,
                    dateFormat: "Y-m-d\\TH:i",
                    altInput: true,
                    altFormat: "Y. F d. H:00",
                    locale: "hu"
                });
            } else {
                console.error("Flatpickr is not loaded!");
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            initializeFlatpickr();
        });

        if (typeof Sys !== 'undefined' && Sys.Application) {
            Sys.Application.add_load(function () {
                initializeFlatpickr();
            });
        }
    })();

    //document.addEventListener('DOMContentLoaded', function () {
    //    fetchFullHours().then(() => {
    //        flatpickr("#StartTime", {
    //            enableTime: true,
    //            time_24hr: true,
    //            enableSeconds: false,
    //            minuteIncrement: 60,
    //            defaultMinute: 0,
    //            defaultDate: getRoundedDate(),
    //            minDate: "today",
    //            allowInput: false,
    //            dateFormat: "Y-m-d\\TH:i",
    //            altInput: true,
    //            altFormat: "Y. F d. H:00",
    //            locale: "hu",
    //            disable: fullHours,
    //            onChange: function (selectedDates, dateStr, instance) {
    //            // Optional: check if selected time is full
    //                if (fullHours.some(d => d.getTime() === selectedDates[0].getTime())) {
    //                    alert("This hour is fully booked. Please select another time.");
    //                    instance.clear();
    //                }
    //            }
    //        });
    //    });
    //});
</script>

@*<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        var serviceUrl = 'http://www.dnndev.me/API/Dnn.Bce.Dnn.Idopontfoglalas/';

        var url = serviceUrl + "ReservationApiController/CreateReservation";

        $('#reservationForm').submit(function (event) {
            event.preventDefault();

            var reservationData = {
                Name: $("#Name").val(),
                Email: $("#Email").val(),
                Phone: $("#Phone").val(),
                Time: $("#Time").val(),
                Quantity: parseInt($("#Quantity").val())
            };
            console.log("ajax előtt");
            $.ajax({
                url: url,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(reservationData),
                success: function (response) {
                    alert('Foglalás sikeresen létrehozva!');
                    window.location.href = 'http://www.dnndev.me/';
                },
                error: function (xhr, status, error) {
                    alert('Hiba történt: ' + error);
                }
            });
            console.log("ajax után");

        });
    </script>*@


<div class="reservation-create-container">
    <h2>Új foglalás</h2>

    <form method="post" id="reservationForm">
        <div class="form-group mb-3">
            <label for="Name">Név</label>
            <input type="text" class="form-control" id="Name" name="Name" placeholder="Teljes név" required />
        </div>

        <div class="form-group mb-3">
            <label for="Email">E-mail</label>
            <input type="email" class="form-control" id="Email" name="Email" placeholder="E-mail cím" required />
        </div>

        <div class="form-group mb-3">
            <label for="Phone">Telefonszám</label>
            <input type="text" class="form-control" id="Phone" name="Phone" placeholder="Telefonszám" required />
        </div>

        <div class="form-group mb-3">
            <label for="StartTime">Időpont</label>
            <input type="text" class="form-control" id="StartTime" name="StartTime" required />
        </div>

        <div class="form-group mb-3">
            <label for="Quantity">Hány főre?</label>
            <input type="number" class="form-control" id="Quantity" name="Quantity" placeholder="fők száma" value=4
                   min="2" max="8" oninvalid="this.setCustomValidity('Csak 2-8 főre lehet foglalni')" oninput="this.setCustomValidity('')" required />
        </div>

        <button type="submit" class="btn btn-primary">Foglalás mentése</button>
    </form>
</div>

